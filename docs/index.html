<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Penny Breakout Signals</title>
  <style>
    :root { --bg:#0b0f14; --card:#121923; --text:#eaf2ff; --muted:#9fb0c8; --buy:#25d366; --hold:#ffaa33; --bad:#ff5577; }
    *{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto;background:var(--bg);color:var(--text)}
    header{padding:18px 20px;border-bottom:1px solid #1c2735;background:#0e141b;position:sticky;top:0}
    h1{margin:0;font-size:18px;font-weight:700}
    .meta{color:var(--muted);font-size:12px;margin-top:4px}
    main{max-width:1100px;margin:20px auto;padding:0 14px}
    .card{background:var(--card);border:1px solid #1c2735;border-radius:14px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{padding:10px 12px;text-align:left}
    th{color:#b7c7df;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.04em}
    tr{background:#0f1620;border-radius:10px}
    tr td:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
    tr td:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-weight:700;font-size:12px}
    .buy{background:rgba(37,211,102,.12);color:#27e38a;border:1px solid rgba(39,227,138,.35)}
    .hold{background:rgba(255,170,51,.12);color:#ffc266;border:1px solid rgba(255,194,102,.35)}
    .muted{color:var(--muted)}
    .mono{font-variant-numeric:tabular-nums;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
    .footer{color:var(--muted);font-size:12px;margin-top:8px}
    .hr{height:1px;background:#1c2735;margin:12px 0}
    .hint{font-size:12px;color:#8aa0bd}
  </style>
</head>
<body>
  <header>
    <h1>Penny Breakout Signals</h1>
    <div class="meta">
      <span id="gen"></span> • TF: <span id="tf"></span> • Regeln: High<span id="n"></span> / Δ%≥<span id="mp"></span> / RSI≥<span id="mr"></span>
    </div>
  </header>

  <main>
    <div class="card">
      <div class="hint">Aktualisiert automatisch (alle 15s). BUY zeigt empfohlene SL/TP/Trailing.</div>
      <div class="hr"></div>
      <table id="tbl">
        <thead>
          <tr>
            <th>Zeit (UTC)</th>
            <th>Ticker</th>
            <th>Empfehlung</th>
            <th>Preis</th>
            <th>Δ%</th>
            <th>RSI</th>
            <th>TP (%, $)</th>
            <th>SL (%, $)</th>
            <th>Trailing %</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="footer">Quelle: GitHub Actions Bot • TradersPost/IBKR via Webhook</div>
    </div>
  </main>

  <script>
    async function load() {
      try {
        const res = await fetch('signals.json?ts=' + Date.now(), { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        render(data);
      } catch (e) {
        console.error(e);
      }
    }

    function fmt(n, d=2){ return (n==null || isNaN(n)) ? '–' : Number(n).toFixed(d); }

    function render(d) {
      document.getElementById('gen').textContent = new Date(d.generated_at).toISOString().replace('T',' ').replace('Z','Z');
      document.getElementById('tf').textContent  = d.timeframe;
      document.getElementById('n').textContent   = d.breakout_len;
      document.getElementById('mp').textContent  = d.min_pct_move;
      document.getElementById('mr').textContent  = d.min_rsi_mom;

      const tbody = document.querySelector('#tbl tbody');
      tbody.innerHTML = '';
      (d.signals || []).forEach(s => {
        const tr = document.createElement('tr');

        const tdTime = `<td class="mono muted">${(s.timestamp||'').replace('T',' ').replace('Z','Z')}</td>`;
        const tdSym  = `<td class="mono"><strong>${s.symbol}</strong></td>`;
        const pill   = s.recommendation === 'BUY' ? '<span class="pill buy">BUY</span>' : '<span class="pill hold">HOLD</span>';
        const tdRec  = `<td>${pill}</td>`;
        const tdP    = `<td class="mono">$ ${fmt(s.price, 4)}</td>`;
        const tdD    = `<td class="mono ${s.pct_move>=0?'':'muted'}">${fmt(s.pct_move,2)}%</td>`;
        const tdR    = `<td class="mono">${fmt(s.rsi,2)}</td>`;

        const tpPct = s.tp_percent!=null ? fmt(s.tp_percent,0)+'%' : '–';
        const tpDol = s.tp_price!=null ? '$ '+fmt(s.tp_price,4) : '–';
        const tdTP  = `<td class="mono">${tpPct} / ${tpDol}</td>`;

        const slPct = s.sl_percent!=null ? fmt(s.sl_percent,0)+'%' : '–';
        const slDol = s.sl_price!=null ? '$ '+fmt(s.sl_price,4) : '–';
        const tdSL  = `<td class="mono">${slPct} / ${slDol}</td>`;

        const tdTr  = `<td class="mono">${s.trailing_percent!=null ? fmt(s.trailing_percent,0)+'%' : '–'}</td>`;

        tr.innerHTML = tdTime+tdSym+tdRec+tdP+tdD+tdR+tdTP+tdSL+tdTr;
        tbody.appendChild(tr);
      });
    }

    load();
    setInterval(load, 15000);
  </script>
</body>
</html>
